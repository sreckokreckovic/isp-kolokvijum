#####Unauthenticated key exchange using public encryption #####
//Alice
Generise svoj key pair za rsa
final KeyPairGenerator kpg = KeyPairGenerator.getInstance("RSA");
kpg.initialize(2048);
final KeyPair aliceKp = kpg.generateKeyPair();
Salje Bobu svoj Public Key:
send("bob",aliceKp.getPublic().getEncoded());
Prima od Boba aesKey kriptovan
final byte[] aesKeyEnc = receive("bob");
Dekriptujemo sad taj kljuc da ga dobijemo
final Cipher rsa = Cipher.getInstance("RSA");
rsa.init(Cipher.DECRYPT_MODE,aliceKp.getPrivate());
final byte[] aesKey = rsa.doFinal(aesKeyEnc);
Rekonstruisemo aes key preko secret key
final SecretKeySpec secretKeySpec = new SecretKeySpec(aesKey,"AES");
Dobili smo kljuc, sada saljemo neku poruku preko aes gcm
final Cipher aes = Cipher.getInstance("AES/GCM/NoPadding");
aes.init(Cipher.ENCRYPT_MODE,secretKeySpec);
final String text = "Neka poruka sto se salje";
final byte[]ct = aes.doFinal(text.getBytes());
Saljemo bobu IV i CT
send("bob",aes.getIV());
send("bob",ct);


//Bob
Prima od Alice njen public RSA:
final byte[] alicePkBytes = receive("alice");
Rekonstruisemo public key od alice
final X509EncodedKeySpec keySpec = new X509EncodedKeySpec(alicePkBytes);
final KeyFactory kf = KeyFactory.getInstance("RSA");
final PublicKey alicePk = kf.generatePublic(keySpec);
Generisemo AES kljuc
final Key aesKey = KeyGenerator.getInstance("AES").generateKey();
Sifrujemo sa RSA sa alice public key sifru za aes
final Cipher rsa = Cipher.getInstance("RSA");
rsa.init(Cipher.ENCRYPT_MODE,alicePk);
final byte[] encrypted = rsa.doFinal(aesKey.getEncoded());
Saljemo sifrovano alice
send("alice",encrypted);
Primamo poruku od alice i desifrujemo
final byte[] receivedIV = receive("alice");
final byte[] ct = receive("alice");

final Cipher cipher = Cipher.getInstance("AES/GCM/NoPadding");
cipher.init(Cipher.DECRYPT_MODE,aesKey,new GCMParameterSpec(128,receivedIV));
final byte[] decrypted = aes.doFinal(ct);

